<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Responsive Calculator</title>
  <style>
    :root{
      --bg: #0f172a;
      --panel: #111827;
      --text: #e5e7eb;
      --muted: #9ca3af;
      --key: #1f2937;
      --key-acc: #2563eb;
      --key-acc-text: #ffffff;
      --key-op: #334155;
      --key-clear: #dc2626;
      --key-clear-text: #ffffff;
      --shadow: 0 10px 25px rgba(0,0,0,.25), 0 2px 8px rgba(0,0,0,.15);
      --radius: 14px;
    }

    @media (prefers-color-scheme: light){
      :root{
        --bg:#f3f4f6;
        --panel:#ffffff;
        --text:#111827;
        --muted:#6b7280;
        --key:#f3f4f6;
        --key-op:#e5e7eb;
        --key-acc:#2563eb;
        --key-acc-text:#ffffff;
        --key-clear:#ef4444;
        --key-clear-text:#ffffff;
        --shadow:0 10px 25px rgba(0,0,0,.08), 0 2px 8px rgba(0,0,0,.06);
      }
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
      background: radial-gradient(1200px 800px at 10% 10%, rgba(37,99,235,.12), transparent 50%),
                  radial-gradient(800px 600px at 90% 20%, rgba(16,185,129,.12), transparent 50%),
                  var(--bg);
      color:var(--text);
      display:grid;
      place-items:center;
      padding:16px;
    }

    .calculator{
      width:min(92vw, 420px);
      background:var(--panel);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      overflow:hidden;
      border:1px solid rgba(255,255,255,.04);
    }

    .display{
      padding:24px 20px;
      font-size: clamp(28px, 5.5vw, 40px);
      font-weight: 700;
      letter-spacing: .5px;
      min-height: 72px;
      display:flex;
      align-items:flex-end;
      justify-content:flex-end;
      background: linear-gradient(180deg, rgba(255,255,255,.04), transparent);
      border-bottom:1px solid rgba(255,255,255,.06);
      word-break: break-all;
    }

    .keys{
      display:grid;
      grid-template-columns: repeat(4, 1fr);
      gap:10px;
      padding:14px;
    }

    button.key{
      appearance:none;
      border:none;
      background:var(--key);
      color:var(--text);
      padding:18px 14px;
      font-size: clamp(18px, 4vw, 22px);
      border-radius:12px;
      cursor:pointer;
      transition: transform .03s ease, background .2s ease, color .2s ease, box-shadow .2s ease;
      box-shadow: inset 0 -2px 0 rgba(0,0,0,.08);
    }
    button.key:active{ transform: translateY(1px) }
    button.key:focus-visible{
      outline: 2px solid rgba(37, 99, 235, .9);
      outline-offset: 2px;
    }

    .key.op{ background: var(--key-op) }
    .key.equals{
      background: var(--key-acc);
      color: var(--key-acc-text);
    }
    .key.clear{
      background: var(--key-clear);
      color: var(--key-clear-text);
    }

    /* Make = span two columns on wider screens */
    @media (min-width:480px){
      .key.equals{ grid-column: span 2 }
    }

    footer{
      text-align:center;
      color:var(--muted);
      font-size:12px;
      margin-top:10px;
      padding-bottom:4px;
    }
    .sr-only{
      position:absolute!important;
      width:1px;height:1px;
      padding:0;margin:-1px;
      overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0
    }
  </style>
</head>
<body>
  <main class="calculator" role="application" aria-label="Basic calculator">
    <div id="display" class="display" role="status" aria-live="polite" aria-atomic="true" aria-label="Calculator display">0</div>
    <div class="keys" id="keys">
      <button class="key clear" data-action="clear" aria-label="Clear">C</button>
      <button class="key op" data-action="operator" data-value="/" aria-label="Divide">÷</button>
      <button class="key op" data-action="operator" data-value="*" aria-label="Multiply">×</button>
      <button class="key op" data-action="operator" data-value="-" aria-label="Subtract">−</button>

      <button class="key" data-action="digit" data-value="7">7</button>
      <button class="key" data-action="digit" data-value="8">8</button>
      <button class="key" data-action="digit" data-value="9">9</button>
      <button class="key op" data-action="operator" data-value="+" aria-label="Add">+</button>

      <button class="key" data-action="digit" data-value="4">4</button>
      <button class="key" data-action="digit" data-value="5">5</button>
      <button class="key" data-action="digit" data-value="6">6</button>
      <button class="key" data-action="decimal" data-value="." aria-label="Decimal point">.</button>

      <button class="key" data-action="digit" data-value="1">1</button>
      <button class="key" data-action="digit" data-value="2">2</button>
      <button class="key" data-action="digit" data-value="3">3</button>
      <button class="key equals" data-action="equals" aria-label="Equals">=</button>

      <button class="key" data-action="digit" data-value="0" style="grid-column: span 2">0</button>
      <button class="key" data-action="decimal" data-value="." aria-label="Decimal point duplicate for convenience">.</button>
      <button class="key op" data-action="operator" data-value="+" aria-label="Add duplicate">+</button>
    </div>
  </main>
  <footer>
    Tip: You can also use your keyboard (0-9, + - * /, Enter, ., Esc).
  </footer>

  <script>
    (function(){
      const display = document.getElementById('display');
      const keys = document.getElementById('keys');
      const operators = ['+','-','*','/'];

      let expr = '';
      let hasError = false;

      function updateDisplay(text){
        display.textContent = text === '' ? '0' : text;
      }

      function setError(msg='Error'){
        hasError = true;
        expr = '';
        display.textContent = msg;
      }

      function lastChar(){
        return expr[expr.length - 1];
      }

      function isOperator(ch){
        return operators.includes(ch);
      }

      function currentNumber(){
        const idx = Math.max(
          expr.lastIndexOf('+'),
          expr.lastIndexOf('-'),
          expr.lastIndexOf('*'),
          expr.lastIndexOf('/')
        );
        return expr.slice(idx + 1);
      }

      function appendDigit(d){
        if(hasError){ hasError=false; expr=''; }
        // Avoid leading zeros like 000 unless after decimal
        const cur = currentNumber();
        if(cur === '0' && d !== '.'){
          // Replace leading zero
          expr = expr.slice(0, -1) + d;
        }else{
          expr += d;
        }
        updateDisplay(expr);
      }

      function appendDecimal(){
        if(hasError){ hasError=false; expr=''; }
        const cur = currentNumber();
        if(cur.includes('.')) return; // prevent multiple decimals in a number
        if(expr === '' || isOperator(lastChar())){
          expr += '0.';
        }else{
          expr += '.';
        }
        updateDisplay(expr);
      }

      function appendOperator(op){
        if(hasError){ hasError=false; expr=''; }
        if(expr === ''){
          // Allow starting negative numbers
          if(op === '-') {
            expr = '-';
            updateDisplay(expr);
          }
          return;
        }
        // Replace operator if last char is operator
        if(isOperator(lastChar())){
          // Allow switching between + - * / by replacing
          expr = expr.slice(0, -1) + op;
        }else{
          expr += op;
        }
        updateDisplay(expr);
      }

      function sanitizeExpression(s){
        // Remove trailing operators or dangling decimal points
        while(s.length && (isOperator(s[s.length-1]) || s[s.length-1] === '.')){
          s = s.slice(0, -1);
        }
        return s;
      }

      function calculate(){
        if(hasError){ return; }
        let safe = sanitizeExpression(expr);
        if(safe === ''){
          updateDisplay('0');
          return;
        }
        // Validate allowed characters
        if(!/^[\d+\-*/.\s]+$/.test(safe)){
          setError('Error');
          return;
        }
        try{
          // Evaluate safely given controlled input (buttons/validated)
          // eslint-disable-next-line no-new-func
          let result = Function('"use strict";return (' + safe + ')')();
          if(!isFinite(result)){
            setError('Error');
            return;
          }
          // Normalize floating point issues (e.g., 0.1+0.2)
          const rounded = Math.round((result + Number.EPSILON) * 1e12) / 1e12;
          expr = String(rounded);
          updateDisplay(expr);
        }catch(e){
          setError('Error');
        }
      }

      function clearAll(){
        expr = '';
        hasError = false;
        updateDisplay(expr);
      }

      keys.addEventListener('click', (e)=>{
        const btn = e.target.closest('button');
        if(!btn) return;
        const action = btn.getAttribute('data-action');
        const value = btn.getAttribute('data-value');
        switch(action){
          case 'digit': appendDigit(value); break;
          case 'decimal': appendDecimal(); break;
          case 'operator': appendOperator(value); break;
          case 'equals': calculate(); break;
          case 'clear': clearAll(); break;
        }
      });

      // Basic keyboard support
      document.addEventListener('keydown', (e)=>{
        const { key } = e;
        if(/\d/.test(key)){ appendDigit(key); return; }
        if(key === '.' ){ appendDecimal(); return; }
        if(['+','-','*','/'].includes(key)){ appendOperator(key); return; }
        if(key === 'Enter' || key === '='){ e.preventDefault(); calculate(); return; }
        if(key === 'Escape'){ clearAll(); return; }
      });

      // Initialize
      updateDisplay(expr);
    })();
  </script>
</body>
</html>